---
layout: default
---

<!-- mathjax config similar to math.stackexchange -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: { equationNumbers: { autoNumber: "AMS" }},
    tex2jax: {
      inlineMath: [ ['$','$'] ],
      processEscapes: true
    },
    "HTML-CSS": { matchFontHeight: false },
    displayAlign: "left",
    displayIndent: "2em"
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-balloon-js@1.1.2/jquery.balloon.min.js" integrity="sha256-ZEYs9VrgAeNuPvs15E39OsyOJaIkXEEt10fzxJ20+2I=" crossorigin="anonymous"></script>
<script type="text/javascript" src="../../../assets/js/copy-button.js"></script>
<link rel="stylesheet" href="../../../assets/css/copy-button.css" />


# :x: test/yukicoder/738.WM.test.cpp

<a href="../../../index.html">Back to top page</a>

* category: <a href="../../../index.html#de60e5ba474ac43bf7562c10f5977e2d">test/yukicoder</a>
* <a href="{{ site.github.repository_url }}/blob/master/test/yukicoder/738.WM.test.cpp">View this file on GitHub</a>
    - Last commit date: 2020-08-27 17:40:42+09:00


* see: <a href="https://yukicoder.me/problems/no/738">https://yukicoder.me/problems/no/738</a>


## Depends on

* :question: <a href="../../../library/src/DataStructure/WaveletMatrix.hpp.html">Wavelet行列</a>


## Code

<a id="unbundled"></a>
{% raw %}
```cpp
#define PROBLEM "https://yukicoder.me/problems/no/738"

#include <bits/stdc++.h>
using namespace std;

#define call_from_test
#include "src/DataStructure/WaveletMatrix.hpp"
#undef call_from_test

signed main() {
  cin.tie(0);
  ios::sync_with_stdio(0);
  int N;
  cin >> N;
  int A[N];
  for (int i = 0; i < N; i++) cin >> A[i];
  int L[N], R[N];
  vector<int> vec(A, A + N);
  for (int i = 0; i < N; i++) {
    cin >> L[i] >> R[i];
    vec.push_back(A[i] - L[i]);
    vec.push_back(A[i] + R[i]);
  }
  sort(vec.begin(), vec.end());
  vec.erase(unique(vec.begin(), vec.end()), vec.end());
  auto id = [&](int x) {
    return lower_bound(vec.begin(), vec.end(), x) - vec.begin();
  };
  vector<int> l(N), r(N);
  for (int i = 0; i < N; i++) {
    l[i] = id(A[i] - L[i]);
    r[i] = id(A[i] + R[i]);
  }
  WaveletMatrix wml(l), wmr(r);
  long long ans = 0;
  for (int i = 0; i < N; i++) {
    int left = lower_bound(A, A + N, A[i] - L[i]) - A;
    int right = upper_bound(A, A + N, A[i] + R[i]) - A;
    int ai = id(A[i]);
    ans += wmr.range_freq(left, i, ai, 4 * N);
    ans += wml.range_freq(i + 1, right, 0, ai + 1);
  }
  cout << ans / 2 << "\n";
  return 0;
}
```
{% endraw %}

<a id="bundled"></a>
{% raw %}
```cpp
#line 1 "test/yukicoder/738.WM.test.cpp"
#define PROBLEM "https://yukicoder.me/problems/no/738"

#include <bits/stdc++.h>
using namespace std;

#define call_from_test
#line 1 "src/DataStructure/WaveletMatrix.hpp"
/**
 * @title Wavelet行列
 * @category データ構造
 * 事前に座圧して使う
 */

#ifndef call_from_test
#line 9 "src/DataStructure/WaveletMatrix.hpp"
using namespace std;
#endif

struct WaveletMatrix {
  struct SuccinctIndexableDictionary {
    size_t length;
    size_t blocks;
    vector<unsigned> bit, sum;
    SuccinctIndexableDictionary() = default;
    SuccinctIndexableDictionary(size_t length)
        : length(length), blocks((length + 31) >> 5) {
      bit.assign(blocks, 0U);
      sum.assign(blocks, 0U);
    }
    void set(int k) { bit[k >> 5] |= 1U << (k & 31); }
    void build() {
      sum[0] = 0U;
      for (size_t i = 1; i < blocks; i++)
        sum[i] = sum[i - 1] + __builtin_popcount(bit[i - 1]);
    }
    bool operator[](int k) { return (bool((bit[k >> 5] >> (k & 31)) & 1)); }
    int rank(int k) {
      return (sum[k >> 5]
              + __builtin_popcount(bit[k >> 5] & ((1U << (k & 31)) - 1)));
    }
    int rank(bool val, int k) { return (val ? rank(k) : k - rank(k)); }
  };

 private:
  unsigned sigma, height;
  size_t length;
  vector<SuccinctIndexableDictionary> matrix;
  vector<int> mid;

 private:
  pair<int, int> succ(bool f, int l, int r, int level) {
    return {matrix[level].rank(f, l) + mid[level] * f,
            matrix[level].rank(f, r) + mid[level] * f};
  }

 public:
  WaveletMatrix() = default;
  WaveletMatrix(vector<int> v)
      : WaveletMatrix(v, *max_element(v.begin(), v.end()) + 1) {}
  WaveletMatrix(vector<int> v, unsigned s) : sigma(s), length(v.size()) {
    height = 32 - __builtin_clz(sigma);
    matrix.resize(height);
    mid.resize(height);
    vector<int> l(length), r(length);
    for (int level = height - 1; level >= 0; level--) {
      matrix[level] = SuccinctIndexableDictionary(length + 1);
      int left = 0, right = 0;
      for (size_t i = 0; i < length; i++) {
        if (((v[i] >> level) & 1))
          matrix[level].set(i), r[right++] = v[i];
        else
          l[left++] = v[i];
      }
      mid[level] = left;
      matrix[level].build();
      v.swap(l);
      for (int i = 0; i < right; i++) v[left + i] = r[i];
    }
  }
  // v[k]
  int access(int k) {
    int ret = 0;
    for (int level = height - 1; level >= 0; level--) {
      bool f = matrix[level][k];
      if (f) ret |= 1 << level;
      k = matrix[level].rank(f, k) + mid[level] * f;
    }
    return ret;
  }
  int operator[](int k) { return access(k); }
  // count i s.t. (0 <= i < r) && v[i] == x
  int rank(int x, int r) {
    int l = 0;
    for (int level = height - 1; level >= 0; level--)
      tie(l, r) = succ((x >> level) & 1, l, r, level);
    return r - l;
  }
  // k-th(0-indexed) smallest number in v[l,r)
  int kth_smallest(int l, int r, int k) {
    assert(0 <= k && k < r - l);
    int ret = 0;
    for (int level = height - 1; level >= 0; level--) {
      int cnt = matrix[level].rank(false, r) - matrix[level].rank(false, l);
      bool f = cnt <= k;
      if (f) ret |= 1 << level, k -= cnt;
      tie(l, r) = succ(f, l, r, level);
    }
    return ret;
  }
  // k-th(0-indexed) largest number in v[l,r)
  int kth_largest(int l, int r, int k) {
    return kth_smallest(l, r, r - l - k - 1);
  }
  // count i s.t. (l <= i < r) && (v[i] < upper)
  int range_freq(int l, int r, int upper) {
    upper = min(upper, (int)sigma);
    int ret = 0;
    for (int level = height - 1; level >= 0; level--) {
      bool f = ((upper >> level) & 1);
      if (f) ret += matrix[level].rank(false, r) - matrix[level].rank(false, l);
      tie(l, r) = succ(f, l, r, level);
    }
    return ret;
  }
  // count i s.t. (l <= i < r) && (lower <= v[i] < upper)
  int range_freq(int l, int r, int lower, int upper) {
    return range_freq(l, r, upper) - range_freq(l, r, lower);
  }
  // max v[i] s.t. (l <= i < r) && (v[i] < upper)
  int prev_value(int l, int r, int upper) {
    int cnt = range_freq(l, r, upper);
    return cnt == 0 ? -1 : kth_smallest(l, r, cnt - 1);
  }
  // min v[i] s.t. (l <= i < r) && (lower <= v[i])
  int next_value(int l, int r, int lower) {
    int cnt = range_freq(l, r, lower);
    return cnt == r - l ? -1 : kth_smallest(l, r, cnt);
  }
};
#line 8 "test/yukicoder/738.WM.test.cpp"
#undef call_from_test

signed main() {
  cin.tie(0);
  ios::sync_with_stdio(0);
  int N;
  cin >> N;
  int A[N];
  for (int i = 0; i < N; i++) cin >> A[i];
  int L[N], R[N];
  vector<int> vec(A, A + N);
  for (int i = 0; i < N; i++) {
    cin >> L[i] >> R[i];
    vec.push_back(A[i] - L[i]);
    vec.push_back(A[i] + R[i]);
  }
  sort(vec.begin(), vec.end());
  vec.erase(unique(vec.begin(), vec.end()), vec.end());
  auto id = [&](int x) {
    return lower_bound(vec.begin(), vec.end(), x) - vec.begin();
  };
  vector<int> l(N), r(N);
  for (int i = 0; i < N; i++) {
    l[i] = id(A[i] - L[i]);
    r[i] = id(A[i] + R[i]);
  }
  WaveletMatrix wml(l), wmr(r);
  long long ans = 0;
  for (int i = 0; i < N; i++) {
    int left = lower_bound(A, A + N, A[i] - L[i]) - A;
    int right = upper_bound(A, A + N, A[i] + R[i]) - A;
    int ai = id(A[i]);
    ans += wmr.range_freq(left, i, ai, 4 * N);
    ans += wml.range_freq(i + 1, right, 0, ai + 1);
  }
  cout << ans / 2 << "\n";
  return 0;
}

```
{% endraw %}

<a href="../../../index.html">Back to top page</a>

