---
data:
  _extendedDependsOn:
  - icon: ':heavy_check_mark:'
    path: src/DataStructure/BinaryIndexedTree_RangeAdd.hpp
    title: "Binary-Indexed-Tree(\u533A\u9593\u52A0\u7B97)"
  - icon: ':question:'
    path: src/Graph/HeavyLightDecomposition.hpp
    title: "HL\u5206\u89E3"
  _extendedRequiredBy: []
  _extendedVerifiedWith: []
  _isVerificationFailed: false
  _pathExtension: cpp
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    '*NOT_SPECIAL_COMMENTS*': ''
    PROBLEM: http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=2667
    links:
    - http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=2667
  bundledCode: "#line 1 \"test/aoj/2667.HLD.test.cpp\"\n#define PROBLEM \"http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=2667\"\
    \n// \u30D1\u30B9\u7DCF\u548C\u3001\u90E8\u5206\u6728\u52A0\u7B97\n#include <iostream>\n\
    #line 2 \"src/Graph/HeavyLightDecomposition.hpp\"\n#include <vector>\n#include\
    \ <algorithm>\nclass HeavyLightDecomposition {\n std::vector<std::vector<int>>\
    \ adj;\n std::vector<int> sz, in, out, head, par;\n void dfs_sz(int v, int p)\
    \ {\n  if (adj[v].size() && adj[v][0] == p) std::swap(adj[v][0], adj[v].back());\n\
    \  for (auto &u: adj[v])\n   if (u != p)\n    if (dfs_sz(u, v), sz[v]+= sz[u];\
    \ sz[adj[v][0]] < sz[u]) std::swap(adj[v][0], u);\n }\n void dfs_hld(int v, int\
    \ p, int &ts) {\n  par[v]= p, in[v]= ts++;\n  for (auto &u: adj[v])\n   if (u\
    \ != p) head[u]= (adj[v][0] == u ? head[v] : u), dfs_hld(u, v, ts);\n  out[v]=\
    \ ts;\n }\npublic:\n HeavyLightDecomposition(int n): adj(n), sz(n, 1), in(n, 0),\
    \ out(n, 0), head(n, 0), par(n, 0) {}\n void add_edge(int u, int v) { adj[u].push_back(v),\
    \ adj[v].push_back(u); }\n void build(int rt= 0) {\n  int timestamp= 0;\n  dfs_sz(rt,\
    \ -1), dfs_hld(rt, -1, timestamp);\n }\n int lca(int u, int v) const {\n  for\
    \ (;; v= par[head[v]]) {\n   if (in[u] > in[v]) std::swap(u, v);\n   if (head[u]\
    \ == head[v]) return u;\n  }\n }\n template <typename T, typename Q, typename\
    \ F> T fold_path(int u, int v, const Q &q, const F &f, const T ti, bool edge=\
    \ false) {\n  T vl= ti, vr= ti;\n  for (;; vl= f(q(in[head[v]], in[v] + 1), vl),\
    \ v= par[head[v]]) {\n   if (in[u] > in[v]) std::swap(u, v), std::swap(vl, vr);\n\
    \   if (head[u] == head[v]) break;\n  }\n  return f(f(q(in[u] + edge, in[v] +\
    \ 1), vl), vr);\n }\n template <typename T, typename Q> T fold_subtree(int v,\
    \ const Q &q, bool edge= false) { return q(in[v] + edge, out[v]); }\n template\
    \ <typename Q> void apply_path(int u, int v, const Q &q, bool edge= false) {\n\
    \  for (;; q(in[head[v]], in[v] + 1), v= par[head[v]]) {\n   if (in[u] > in[v])\
    \ std::swap(u, v);\n   if (head[u] == head[v]) break;\n  }\n  q(in[u] + edge,\
    \ in[v] + 1);\n }\n template <typename Q> void apply_subtree(int v, const Q &q,\
    \ bool edge= false) { q(in[v] + edge, out[v]); }\n int operator[](int i) const\
    \ { return in[i]; }\n};\n#line 3 \"src/DataStructure/BinaryIndexedTree_RangeAdd.hpp\"\
    \ntemplate <typename T> class BinaryIndexedTree_RangeAdd {\n std::vector<T> dat1,\
    \ dat2;\npublic:\n BinaryIndexedTree_RangeAdd(int n): dat1(n + 1, T()), dat2(n\
    \ + 1, T()) {}\n void add_range(int l, int r, T w) {  // add w [l,r)\n  int n=\
    \ dat1.size();\n  for (int k= l + 1; k < n; k+= k & -k) dat1[k]-= w * l;\n  for\
    \ (int k= r + 1; k < n; k+= k & -k) dat1[k]+= w * r;\n  for (int k= l + 1; k <\
    \ n; k+= k & -k) dat2[k]+= w;\n  for (int k= r + 1; k < n; k+= k & -k) dat2[k]-=\
    \ w;\n }\n T sum(int x) const {  // sum [0,x)\n  T s= 0;\n  for (int k= x; k;\
    \ k&= k - 1) s+= dat1[k];\n  for (int k= x; k; k&= k - 1) s+= dat2[k] * x;\n \
    \ return s;\n }\n T sum(int l, int r) const { return sum(r) - sum(l); }  // sum\
    \ [l,r)\n T operator[](size_t k) const { return sum(k + 1) - sum(k); }\n};\n#line\
    \ 6 \"test/aoj/2667.HLD.test.cpp\"\nusing namespace std;\nsigned main() {\n cin.tie(0);\n\
    \ ios::sync_with_stdio(0);\n int N, Q;\n cin >> N >> Q;\n HeavyLightDecomposition\
    \ hld(N);\n for (int i= 0; i < N - 1; i++) {\n  int a, b;\n  cin >> a >> b;\n\
    \  hld.add_edge(a, b);\n }\n hld.build();\n BinaryIndexedTree_RangeAdd<long long>\
    \ bit(N);\n auto q= [&](int l, int r) { return bit.sum(l, r); };\n auto f= [&](long\
    \ long vl, long long vr) { return vl + vr; };\n while (Q--) {\n  int op, x, y;\n\
    \  cin >> op >> x >> y;\n  if (op) {\n   auto upd= [&](int l, int r) { bit.add_range(l,\
    \ r, y); };\n   hld.apply_subtree(x, upd, true);\n  } else {\n   cout << hld.fold_path(x,\
    \ y, q, f, 0ll, true) << \"\\n\";\n  }\n }\n return 0;\n}\n"
  code: "#define PROBLEM \"http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=2667\"\
    \n// \u30D1\u30B9\u7DCF\u548C\u3001\u90E8\u5206\u6728\u52A0\u7B97\n#include <iostream>\n\
    #include \"src/Graph/HeavyLightDecomposition.hpp\"\n#include \"src/DataStructure/BinaryIndexedTree_RangeAdd.hpp\"\
    \nusing namespace std;\nsigned main() {\n cin.tie(0);\n ios::sync_with_stdio(0);\n\
    \ int N, Q;\n cin >> N >> Q;\n HeavyLightDecomposition hld(N);\n for (int i= 0;\
    \ i < N - 1; i++) {\n  int a, b;\n  cin >> a >> b;\n  hld.add_edge(a, b);\n }\n\
    \ hld.build();\n BinaryIndexedTree_RangeAdd<long long> bit(N);\n auto q= [&](int\
    \ l, int r) { return bit.sum(l, r); };\n auto f= [&](long long vl, long long vr)\
    \ { return vl + vr; };\n while (Q--) {\n  int op, x, y;\n  cin >> op >> x >> y;\n\
    \  if (op) {\n   auto upd= [&](int l, int r) { bit.add_range(l, r, y); };\n  \
    \ hld.apply_subtree(x, upd, true);\n  } else {\n   cout << hld.fold_path(x, y,\
    \ q, f, 0ll, true) << \"\\n\";\n  }\n }\n return 0;\n}\n"
  dependsOn:
  - src/Graph/HeavyLightDecomposition.hpp
  - src/DataStructure/BinaryIndexedTree_RangeAdd.hpp
  isVerificationFile: true
  path: test/aoj/2667.HLD.test.cpp
  requiredBy: []
  timestamp: '2023-01-21 16:53:05+09:00'
  verificationStatus: TEST_ACCEPTED
  verifiedWith: []
documentation_of: test/aoj/2667.HLD.test.cpp
layout: document
redirect_from:
- /verify/test/aoj/2667.HLD.test.cpp
- /verify/test/aoj/2667.HLD.test.cpp.html
title: test/aoj/2667.HLD.test.cpp
---
